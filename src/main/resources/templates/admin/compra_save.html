<head th:replace="~{admin/fragment/head}"></head>
<div class="container-fluid">
	<div class="card shadow m-4 p-5">

		<h3 class="text-center">Nueva compra</h3>

		<form method="post" th:object="${compraProducto}" th:action="@{/compra/agregar-producto}">
			<div class="row">
				<div class="col-6">
					<label>Fecha</label>
					<input class="form-control" th:value="${compra.fecha}" readonly>
				</div>
				<div class="col-6">
					<label>Proveedor</label>
					<input class="form-control" th:value="${compra.proveedor.nombre}" readonly>
				</div>
			</div>
			<div class="row">
				<div class="col-6">
					<label>Producto</label>
					<select required class="form-control" th:field="${compraProducto.producto}">
						<option value="" hidden="true">Seleccione un producto</option>
						<option th:each="producto : ${productos}" th:value="${producto.productoId}"
							th:text="${producto.nombre}+' - S/'+${producto.precioCompra}">
						</option>
					</select>
				</div>
				<div class="col-3">
					<label>Cantidad</label>
					<input required minlength="1" maxlength="8" onkeypress="return validarNumeros(event, this)"
						class="form-control" th:field="${compraProducto.cantidad}" type="number" min="1">
				</div>
				<div class="col-3 d-flex flex-column">
					<div class="mt-auto d-grid gap-2">
						<button type="submit" class="btn btn-info">Agregar producto</button>
					</div>
				</div>
			</div>
		</form>

		<hr class="border-bottom">
		<table class="table table-striped table-hover" id="tablaProductos">
			<thead>
				<th>Opciones</th>
				<th>#</th>
				<th>Producto</th>
				<th>Precio de compra</th>
				<th>Cantidad</th>
				<th>Monto</th>
			</thead>
			<tbody class="table-group-divider">
				<tr th:each="compraProducto, itrStat : ${listaCompra}">
					<td>
						<a class="btn btn-danger" th:href="@{'/compra/aumentar-producto/' + ${itrStat.index}}"> <i
								class="fa-solid fa-plus"></i></a>
						<a class="btn btn-danger" th:href="@{'/compra/disminuir-producto/' + ${itrStat.index}}"> <i
								class="fa-solid fa-minus"></i></a>
						<a class="btn btn-danger" th:href="@{'/compra/quitar-producto/' + ${itrStat.index}}"> <i
								class="fa-solid fa-trash-can"></i>
					</td>
					<td th:text="${itrStat.index+1}"></td>
					<td th:text="${compraProducto.producto.nombre}"></td>
					<td th:text="${compraProducto.producto.precioCompra}"></td>
					<td th:text="${compraProducto.cantidad}"></td>
					<td th:text="${compraProducto.producto.precioCompra}*${compraProducto.cantidad}"></td>
				</tr>
				<tr th:if="${total==null || total==0.0}">
					<td class="text-center" colspan="6">Agregue algunos productos</td>
				</tr>
				<tr th:if="${total!=null && total!=0.0}">
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td class="text-end fw-bold">Total</td>
					<td class="fw-bold" th:text="'S/'+${total}"></td>
				</tr>
			</tbody>
		</table>
		<hr class="border-bottom">
		<form method="post" th:object="${compra}" th:action="@{/compra/registrar}">
			<button type="submit" class="btn btn-primary">Registrar compra</button>
		</form>
	</div>
</div>
<footer th:replace="~{admin/fragment/foot}"></footer>